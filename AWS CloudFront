AWS CloudFront

 - Cloudfront is a Content delivery network (CDN)
 - Improves read performance, content is cached at the edge
 - Improves user experience by lowering latency
 - 216 points of presence (edge locations)
 - DDoS protection (because it is worldwide)
 - Integration with Shield and AWS Web Application Firewall


 - Cloudfront - Origins:
    1. S3 bucket:
       - For distributing files and caching them at the edge location
       - Enhanced security with CloudFront Origin Access Control (OAC)
       - OAC is replacing Origin Access Identity (OAI)
       - CloudFront can be used as an ingress (to upload files to S3)
       - S3 bucket must have a policy configured to allow CloudFront access
    2. Custom Origin (HTTP):
       - Application load balancer
       - EC2 instance
       - S3 website (must first enable the bucket as a static S3 website)
       - Any HTTP backend you want


- How CloudFront works:
    1. Content from an S3 bucket(origin) is sent to the Edge location and cached
    2. A request is made to retrieve content from an S3 bucket
    3. The request is routed to the edge location (as it is closer, thus reducing latency)
    4. If the content is not in the cache, then it is fetched from the S3 bucket 

 - CoudFront vs S3 Cross-region replication:
    1. CloudFront:
       - Global Edge network
       - Files are cached for a TTL (maybe a day)
       - Great for static content that must be available everywhere
    2. Cross region replication:
       - Must be setup for each region in which you want replication to happen
       - Files are updated in ner real-time (no caching)
       - Read only
       - Great for dynamic content that needs to be available at low-latency in few regions


 - CloudFront - ALB or EC2 as an origin:
    1. EC2:
       - EC2 must be configured to allow the public IP of the Edge locations
       - Configuration works via EC2 Security groups (set to allow the IP)
       - EC2 instance must be public
    2. ALB:
       - ALB must be public
       - EC2 instances behind the ALB can be private, as the ALB can connect to private resources
       - ALB must be configured to allow the public IP of the Edge locations
       - Configuration works via ALB Security groups (set to allow the IP) 


 - CloudFront Geo restriction:
 - You can restrict who can access your distribution (based on country):
    1. Allowlist: Allow your users to access content if they're in one of the countries on the approved list
    2. Blocklist: Prevent your users from accessing content if they're in one of the countries on the banned list
 - The "country" is determined using a 3rd party Geo-IP database
 - Use case: Copyright laws to restrict access to content


 - CloudFront - Pricing (price classes):
 - Edge locations are all around the world, thus the cost of data per edge location varies
 - You can reduce the number of edge locations for cost reduction
 - Three price classes available:
    1. Price class All: all regions - best performance
    2. Price class 200: most regions, but excludes most expensive regions
    3. Price class 100: only the least expensive regions


 - CloudFront - Cache invalidations
 - In case you update the back-end origin, CloudFront doesn't know about it and will only get refreshed content after expired TTL
 - You can force an entire or partial cache refresh (bypassing the TTL) by performing a CloudFront invalidation
 - You can invalidate all files (*) or a particular path (/images/*)
 - When the files are invalidated, the cache fetches files again
